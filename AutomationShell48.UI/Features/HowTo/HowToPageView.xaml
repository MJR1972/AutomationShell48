<UserControl x:Class="AutomationShell48.UI.Features.HowTo.HowToPageView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="16" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Page heading -->
        <StackPanel Grid.Row="0">
            <TextBlock Text="How To" Style="{StaticResource H1TextStyle}" />
            <TextBlock Margin="0,6,0,0"
                       Style="{StaticResource BodyTextStyle}"
                       Text="In-app training guides for working inside the AutomationShell48 template." />
        </StackPanel>

        <!-- Main split layout: left document list + right document viewer -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" />
                <ColumnDefinition Width="16" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- LEFT PANEL: search + filtered doc list -->
            <Border Grid.Column="0" Style="{StaticResource CardSurfaceStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="10" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <StackPanel>
                        <TextBlock Text="Documents" Style="{StaticResource H3TextStyle}" />
                        <TextBox Margin="0,10,0,0"
                                 Style="{StaticResource ModernTextBoxStyle}"
                                 Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}" />
                    </StackPanel>

                    <ListBox Grid.Row="2"
                             ItemsSource="{Binding FilteredDocuments}"
                             SelectedItem="{Binding SelectedDocument, Mode=TwoWay}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Title}" Style="{StaticResource BodyTextStyle}" />
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <!-- RIGHT PANEL: top action bar + rendered markdown -->
            <Border Grid.Column="2" Style="{StaticResource CardSurfaceStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="12" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- TOP BAR -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="{Binding DocumentStatusText}" Style="{StaticResource CaptionTextStyle}" VerticalAlignment="Center" />

                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Style="{StaticResource SecondaryButtonStyle}"
                                    MinWidth="126"
                                    Height="34"
                                    Command="{Binding ToggleExpandCollapseCommand}"
                                    Content="{Binding ExpandCollapseButtonText}" />
                            <Button Style="{StaticResource PrimaryButtonStyle}"
                                    MinWidth="126"
                                    Height="34"
                                    Command="{Binding ExportToPdfCommand}"
                                    Content="Export to PDF" />
                        </StackPanel>
                    </Grid>

                    <!-- CENTER PANEL: FlowDocument viewer -->
                    <FlowDocumentScrollViewer Grid.Row="2"
                                              Document="{Binding RenderedDocument}"
                                              VerticalScrollBarVisibility="Auto"
                                              HorizontalScrollBarVisibility="Disabled"
                                              IsToolBarVisible="False" />
                </Grid>
            </Border>
        </Grid>

        <!-- Overlay for shared busy pattern -->
        <Border Background="#66000000" Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="240" Height="10" />
                <TextBlock Margin="0,10,0,0" Text="{Binding BusyMessage}" Foreground="White" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
