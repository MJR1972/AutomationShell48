<Window x:Class="AutomationShell48.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="AutomationShell48"
        MinWidth="960"
        MinHeight="640"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="CanResize"
        Background="{DynamicResource WindowBackgroundBrush}"
        Foreground="{DynamicResource TextPrimaryBrush}"
        PreviewKeyDown="Window_PreviewKeyDown">
    <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="52" />
                <RowDefinition Height="*" />
                <RowDefinition Height="36" />
            </Grid.RowDefinitions>

            <Border Grid.Row="0"
                    Background="{DynamicResource SurfaceTitleBarBrush}"
                    BorderBrush="{DynamicResource DividerTitleBarBrush}"
                    BorderThickness="0,0,0,1">
                <Grid x:Name="TitleBar" Background="Transparent" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0,0,0">
                        <TextBlock Text="AutomationShell48" Style="{StaticResource H3TextStyle}" />
                        <TextBlock Margin="10,0,0,0" Text="SaaS Shell" Style="{StaticResource CaptionTextStyle}" />
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,10,0" VerticalAlignment="Center">
                        <Button Style="{StaticResource TopBarButtonStyle}" Click="Minimize_Click" ToolTip="Minimize">
                            <TextBlock Text="-" FontSize="18" Margin="0,-4,0,0" />
                        </Button>
                        <Button Style="{StaticResource TopBarButtonStyle}" Click="MaxRestore_Click" ToolTip="Maximize/Restore">
                            <TextBlock Text="□" FontSize="11" />
                        </Button>
                        <Button Width="44" Height="32" Style="{StaticResource DangerButtonStyle}" Click="Close_Click" ToolTip="Close" Margin="6,0,0,0">
                            <TextBlock Text="X" FontSize="11" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="{Binding IsSidebarCollapsed, Converter={StaticResource BoolToGridLengthConverter}}" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,1,0">
                    <DockPanel LastChildFill="True">
                        <Button DockPanel.Dock="Top"
                                Height="36"
                                Margin="10,12,10,8"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding ToggleSidebarCommand}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="☰" FontSize="14" />
                                <TextBlock Margin="8,0,0,0"
                                           Text="Menu"
                                           Visibility="{Binding IsSidebarCollapsed, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}" />
                            </StackPanel>
                        </Button>

                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <ItemsControl ItemsSource="{Binding NavigationGroups}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Expander IsExpanded="{Binding IsExpanded}" Style="{StaticResource NavGroupExpanderStyle}">
                                            <Expander.Header>
                                                <TextBlock Text="{Binding Title}"
                                                           Style="{StaticResource CaptionTextStyle}"
                                                           Visibility="{Binding DataContext.IsSidebarCollapsed, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}" />
                                            </Expander.Header>
                                            <ItemsControl ItemsSource="{Binding Items}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Button Style="{StaticResource NavItemButtonStyle}"
                                                                ToolTip="{Binding DisplayName}"
                                                                Command="{Binding DataContext.NavigateCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                CommandParameter="{Binding}">
                                                            <Grid Margin="4,0">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="32" />
                                                                    <ColumnDefinition Width="*" />
                                                                </Grid.ColumnDefinitions>
                                                                <Path Grid.Column="0"
                                                                      Width="16"
                                                                      Height="16"
                                                                      VerticalAlignment="Center"
                                                                      HorizontalAlignment="Center"
                                                                      Fill="{DynamicResource IconBrush}"
                                                                      Data="{Binding IconKey, Converter={StaticResource IconKeyToGeometryConverter}}" />
                                                                <TextBlock Grid.Column="1"
                                                                           VerticalAlignment="Center"
                                                                           Margin="10,0,8,0"
                                                                           Text="{Binding DisplayName}"
                                                                           Style="{StaticResource BodyTextStyle}"
                                                                           Visibility="{Binding DataContext.IsSidebarCollapsed, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}" />
                                                            </Grid>
                                                        </Button>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </Expander>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </DockPanel>
                </Border>

                <Grid Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="54" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1">
                        <Grid Margin="16,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="{Binding CurrentPageTitle}" VerticalAlignment="Center" Style="{StaticResource H2TextStyle}" />

                            <StackPanel x:Name="SettingsHeaderActions"
                                        Grid.Column="1"
                                        Orientation="Horizontal"
                                        VerticalAlignment="Center"
                                        Visibility="{Binding IsSettingsActive, Converter={StaticResource BoolToVisibilityConverter}}">
                                <Button Style="{StaticResource ThemeActionButtonStyle}" Margin="0,0,8,0" Command="{Binding OpenLogViewerCommand}">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Path Width="14" Height="14" Fill="{DynamicResource IconBrush}" Data="{Binding LogIconKey, Converter={StaticResource IconKeyToGeometryConverter}}" />
                                        <TextBlock Margin="8,0,0,0" Text="Logs" Style="{StaticResource CaptionTextStyle}" />
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ThemeActionButtonStyle}" Command="{Binding ToggleThemeCommand}">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Path Width="14" Height="14" Fill="{DynamicResource IconBrush}" Data="{Binding ThemeIconKey, Converter={StaticResource IconKeyToGeometryConverter}}" />
                                        <TextBlock Margin="8,0,0,0" Text="Theme" Style="{StaticResource CaptionTextStyle}" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <Border Grid.Row="1" Padding="18,16,18,18">
                        <ContentControl Content="{Binding CurrentViewModel}" />
                    </Border>
                </Grid>

                <Border Grid.ColumnSpan="2"
                        Background="#7A000000"
                        Visibility="{Binding IsDialogOpen, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Grid>
                        <ContentControl Content="{Binding DialogViewModel}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Grid>
                </Border>
            </Grid>

            <Border Grid.Row="2" Background="{DynamicResource StatusSurfaceBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0">
                <Grid Margin="12,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Ellipse Width="7" Height="7" Fill="{DynamicResource AccentBrush}" Margin="0,0,8,0" />
                        <TextBlock Text="{Binding StatusText}" Style="{StaticResource CaptionTextStyle}" />
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding CurrentThemeLabel}" Style="{StaticResource CaptionTextStyle}" />
                        <Rectangle Width="1" Height="14" Margin="12,0" Fill="{DynamicResource BorderBrush}" />
                        <TextBlock Text="{Binding CurrentTime}" Style="{StaticResource CaptionTextStyle}" />
                    </StackPanel>
                </Grid>
            </Border>

            <Thumb Name="ResizeLeft" Width="6" HorizontalAlignment="Left" VerticalAlignment="Stretch" Cursor="SizeWE" DragDelta="ResizeThumb_DragDelta" />
            <Thumb Name="ResizeRight" Width="6" HorizontalAlignment="Right" VerticalAlignment="Stretch" Cursor="SizeWE" DragDelta="ResizeThumb_DragDelta" />
            <Thumb Name="ResizeTop" Height="6" HorizontalAlignment="Stretch" VerticalAlignment="Top" Cursor="SizeNS" DragDelta="ResizeThumb_DragDelta" />
            <Thumb Name="ResizeBottom" Height="6" HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Cursor="SizeNS" DragDelta="ResizeThumb_DragDelta" />
            <Thumb Name="ResizeTopLeft" Width="10" Height="10" HorizontalAlignment="Left" VerticalAlignment="Top" Cursor="SizeNWSE" DragDelta="ResizeThumb_DragDelta" />
            <Thumb Name="ResizeTopRight" Width="10" Height="10" HorizontalAlignment="Right" VerticalAlignment="Top" Cursor="SizeNESW" DragDelta="ResizeThumb_DragDelta" />
            <Thumb Name="ResizeBottomLeft" Width="10" Height="10" HorizontalAlignment="Left" VerticalAlignment="Bottom" Cursor="SizeNESW" DragDelta="ResizeThumb_DragDelta" />
            <Thumb Name="ResizeBottomRight" Width="10" Height="10" HorizontalAlignment="Right" VerticalAlignment="Bottom" Cursor="SizeNWSE" DragDelta="ResizeThumb_DragDelta" />
        </Grid>
    </Border>
</Window>
